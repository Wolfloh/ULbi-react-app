{"ast":null,"code":"import _regeneratorRuntime from\"D:/FRONT-END/my-react/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"D:/FRONT-END/my-react/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"D:/FRONT-END/my-react/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/FRONT-END/my-react/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useRef,useState}from\"react\";import{MyButton}from\"../components/UI/button/MyButton\";import{PostForm}from\"../components/PostForm\";import{PostFilter}from\"../components/PostFilter\";import{MyModal}from\"../components/UI/MyModal/MyModal\";import{usePosts}from\"../hooks/usePosts\";import{useEffect}from\"react\";import PostService from\"../API/PostService\";import{useFetching}from\"../hooks/useFetching\";import{getPageCount}from\"../utils/pages\";import{Pagination}from\"../components/UI/pagination/Pagination\";import'../styles/App.scss';import{useObserver}from\"../hooks/useObserver\";import{PostItems}from\"../components/PostItems\";import{NumberOfPosts}from'../components/NumberOfPosts';import{SetEndlessPosts}from'../components/UI/SetEndlessPosts/SetEndlessPosts';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var Posts=function Posts(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),posts=_useState2[0],setPosts=_useState2[1];var _useState3=useState({sort:'',query:''}),_useState4=_slicedToArray(_useState3,2),filter=_useState4[0],setFilter=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),modal=_useState6[0],setModal=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),totalPages=_useState8[0],setTotalPages=_useState8[1];var _useState9=useState(10),_useState10=_slicedToArray(_useState9,2),limit=_useState10[0],setLimit=_useState10[1];var _useState11=useState(1),_useState12=_slicedToArray(_useState11,2),page=_useState12[0],setPage=_useState12[1];var _useState13=useState(true),_useState14=_slicedToArray(_useState13,2),observe=_useState14[0],setObserve=_useState14[1];var lastElement=useRef();var _useFetching=useFetching(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response,totalCount;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return PostService.getAll(limit,page);case 2:response=_context.sent;if(observe){setPosts([].concat(_toConsumableArray(posts),_toConsumableArray(response.data)));}else{setPosts(response.data);}totalCount=response.headers['x-total-count'];setTotalPages(getPageCount(totalCount,limit));case 6:case\"end\":return _context.stop();}},_callee);}))),_useFetching2=_slicedToArray(_useFetching,3),fetchPosts=_useFetching2[0],isPostsLoading=_useFetching2[1],postError=_useFetching2[2];var removePost=function removePost(post){setPosts(posts.filter(function(p){return p.id!==post.id;}));};useObserver(lastElement.current,function(){return setPage(page+1);},page<totalPages,isPostsLoading,posts.length,observe);useEffect(function(){fetchPosts();},[page,limit]);var sortedAndSearchedPosts=usePosts(posts,filter.sort,filter.query);return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(MyButton,{onClick:function onClick(){return setModal(true);},children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u041F\\u043E\\u0441\\u0442\"}),/*#__PURE__*/_jsx(MyModal,{visible:modal,setVisible:setModal,children:/*#__PURE__*/_jsx(PostForm,{posts:posts,setPosts:setPosts,setModal:setModal})}),/*#__PURE__*/_jsx(PostFilter,{filter:filter,setFilter:setFilter}),/*#__PURE__*/_jsx(SetEndlessPosts,{setObserve:setObserve}),/*#__PURE__*/_jsx(NumberOfPosts,{limit:limit,setLimit:setLimit,observe:observe,setPage:setPage}),/*#__PURE__*/_jsx(PostItems,{isPostsLoading:isPostsLoading,remove:removePost,posts:sortedAndSearchedPosts,title:'Список постов',error:postError}),/*#__PURE__*/_jsx(\"div\",{ref:lastElement}),/*#__PURE__*/_jsx(Pagination,{totalPages:totalPages,page:page,setPage:setPage,observe:observe})]});};","map":{"version":3,"names":["React","useRef","useState","MyButton","PostForm","PostFilter","MyModal","usePosts","useEffect","PostService","useFetching","getPageCount","Pagination","useObserver","PostItems","NumberOfPosts","SetEndlessPosts","jsx","_jsx","jsxs","_jsxs","Posts","_useState","_useState2","_slicedToArray","posts","setPosts","_useState3","sort","query","_useState4","filter","setFilter","_useState5","_useState6","modal","setModal","_useState7","_useState8","totalPages","setTotalPages","_useState9","_useState10","limit","setLimit","_useState11","_useState12","page","setPage","_useState13","_useState14","observe","setObserve","lastElement","_useFetching","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","totalCount","wrap","_callee$","_context","prev","next","getAll","sent","concat","_toConsumableArray","data","headers","stop","_useFetching2","fetchPosts","isPostsLoading","postError","removePost","post","p","id","current","length","sortedAndSearchedPosts","className","children","onClick","visible","setVisible","remove","title","error","ref"],"sources":["D:/FRONT-END/my-react/src/pages/Posts.jsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\r\nimport { MyButton } from \"../components/UI/button/MyButton\";\r\nimport { PostForm } from \"../components/PostForm\";\r\nimport { PostFilter } from \"../components/PostFilter\";\r\nimport { MyModal } from \"../components/UI/MyModal/MyModal\";\r\nimport { usePosts } from \"../hooks/usePosts\";\r\nimport { useEffect } from \"react\";\r\nimport PostService from \"../API/PostService\";\r\nimport { useFetching } from \"../hooks/useFetching\";\r\nimport { getPageCount } from \"../utils/pages\";\r\nimport { Pagination } from \"../components/UI/pagination/Pagination\";\r\nimport '../styles/App.scss'\r\nimport { useObserver } from \"../hooks/useObserver\";\r\nimport { PostItems } from \"../components/PostItems\";\r\nimport { NumberOfPosts } from '../components/NumberOfPosts'\r\nimport { SetEndlessPosts } from '../components/UI/SetEndlessPosts/SetEndlessPosts'\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport const Posts = () => {\r\n    const [posts, setPosts] = useState([]);\r\n    const [filter, setFilter] = useState({ sort: '', query: '' })\r\n    const [modal, setModal] = useState(false);\r\n    const [totalPages, setTotalPages] = useState(0);\r\n    const [limit, setLimit] = useState(10);\r\n    const [page, setPage] = useState(1);\r\n    const [observe, setObserve] = useState(true);\r\n    const lastElement = useRef();\r\n    const [fetchPosts, isPostsLoading, postError] = useFetching(async () => {\r\n        const response = await PostService.getAll(limit, page);\r\n        if (observe) {\r\n            setPosts([...posts, ...response.data]);\r\n        } else {\r\n            setPosts(response.data);\r\n        }\r\n        const totalCount = response.headers['x-total-count'];\r\n        setTotalPages(getPageCount(totalCount, limit))\r\n    });\r\n\r\n    const removePost = (post) => {\r\n        setPosts(posts.filter(p => p.id !== post.id))\r\n    }\r\n\r\n    useObserver(\r\n        lastElement.current,\r\n        () => setPage(page + 1),\r\n        page < totalPages,\r\n        isPostsLoading,\r\n        posts.length,\r\n        observe\r\n    );\r\n\r\n    useEffect(() => {\r\n        fetchPosts();\r\n    }, [page, limit])\r\n\r\n\r\n    const sortedAndSearchedPosts = usePosts(posts, filter.sort, filter.query)\r\n\r\n    return (\r\n        <div className=\"App\">\r\n            <MyButton onClick={() => setModal(true)}>\r\n                Создать Пост\r\n            </MyButton>\r\n            <MyModal visible={modal} setVisible={setModal}>\r\n                <PostForm posts={posts} setPosts={setPosts} setModal={setModal} />\r\n            </MyModal>\r\n            <PostFilter\r\n                filter={filter}\r\n                setFilter={setFilter}\r\n            />\r\n            <SetEndlessPosts setObserve={setObserve} />\r\n            <NumberOfPosts limit={limit} setLimit={setLimit} observe={observe} setPage={setPage} />\r\n            <PostItems\r\n                isPostsLoading={isPostsLoading}\r\n                remove={removePost}\r\n                posts={sortedAndSearchedPosts}\r\n                title={'Список постов'}\r\n                error={postError}\r\n            />\r\n            <div ref={lastElement} />\r\n            <Pagination totalPages={totalPages} page={page} setPage={setPage} observe={observe} />\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}